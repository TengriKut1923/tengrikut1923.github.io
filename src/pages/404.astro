---
import BaseLayout from '@/layouts/BaseLayout.astro';
import siteMetadata from '@/config/siteMetadata';
import Logger from '@/utils/logger';

const title = `404 - Bulunamadı | ${siteMetadata.siteName}`;
const description = "Aradığınız sayfa bulunamadı.";

Logger.warn(`[404] Sayfa bulunamadı: ${Astro.url.pathname}`);
---
<BaseLayout title={title} description={description} extend={{ meta: [{ name: 'robots', content: 'noindex' }] }}>
    <main style="text-align: center; padding: 4rem 1rem;">
        <h1>404 - Sayfa Bulunamadı</h1>
        <p>{description}</p>
        <p>Ana sayfaya dönmek için <a href="/">buraya tıklayın</a>.</p>
    </main>

    {/* İstemci tarafı yönlendirme script'i (sessiz çalışma) */}
    <script is:inline>
      (function() {
        const path = location.pathname;
        const search = location.search;
        const hash = location.hash;

        // Yönlendirme gerektirmeyen yolları kontrol et (örn: assetler, API'ler)
        if (path === '/' || path.toLowerCase() === '/index.html' || /\.(css|js|json|png|svg|webp|woff2|ico|webmanifest|xml|txt|map|gz|br)$/i.test(path) || path.startsWith('/_astro/') || path.startsWith('/pagefind/')) {
          console.info('[404-Redirect] Bu yol için yönlendirme atlandı:', path);
          return;
        }

        // Geçerli yolu sessionStorage'a kaydet
        const redirectPath = path + search + hash;
        try {
            sessionStorage.setItem('redirectPath', redirectPath);
            console.info('[404-Redirect] Yönlendirme yolu kaydedildi:', redirectPath);
        } catch (e) {
            console.error('[404-Redirect] sessionStorage kullanılamıyor:', e);
            // sessionStorage yoksa yönlendirme yapma, kullanıcı manuel dönsün
            return;
        }


        // Ana sayfaya yönlendir (history.replaceState state kaybına neden olabilir, location.replace daha güvenli)
        const basePath = '/'; // Ana sayfa yolu
        console.info(`[404-Redirect] Yönlendiriliyor: ${path} -> ${basePath}`);
        location.replace(basePath); // Tam sayfa yenilemesi ile ana sayfaya git
      })();
    </script>
</BaseLayout>